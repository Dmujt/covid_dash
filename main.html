<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <title>GrizzHacks2020</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js" integrity="sha512-4UKI/XKm3xrvJ6pZS5oTRvIQGIzZFoXR71rRBb1y2N+PbwAsKa5tPl2J6WvbEvwN3TxQCm8hMzsl/pO+82iRlg==" crossorigin="anonymous"></script>

</head>
<body>
<div class="container-fluid" style="margin-top: 10px;">
<div class="row justify-content-md-center">
    <div class="col col-lg-10 col-md-10 col-sm-12">
        <nav class="navbar navbar-expand-lg  navbar-dark bg-dark ">
            <a class="navbar-brand" href="#">COVID Case Predictions</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>    
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Link1</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Link2</a>
                </li>
              </ul>
            </div>
        </nav>
        <div class="row mt-2">
            <div class="col col-lg-5 col-md-9 col-sm-12">
                <div class="card" style='min-height:250px' >
                    <div class="card-body" id="map-container">

                    </div>
                </div>
            </div>
            <div class="col col-lg-7 col-md-3 col-sm-12">
                <div class="card">
                    <div class="card-body">
                      Number Here
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col col-sm-6">
                        <div class="card">
                            <div class="card-body">
                              Pie Chart Here
                            </div>
                        </div>
                    </div>
                    <div class="col col-sm-6">
                        <div class="card">
                            <div class="card-body">
                              Pie Chart2 Here
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col col-lg-10 col-md-8 col-sm-12">
                <div class="card">
                    <div class="card-body">
                      Graph 2 Here
                    </div>
                </div>
            </div>
            <div class="col col-lg-2 col-md-4 col-sm-12">
                <div class="card">
                    <div class="card-body">
                        Something Else
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div>
</body>
<script>

//We will build a basic function to handle window resizing.
function resize() {
    let width = document.getElementById('#map-container').clientWidth;
    let height = width / 2;
    d3.select('#map-container svg')
      .attr('width', width)
      .attr('height', height);
}


$(document).ready(function(){

//*********************** Map of Michigan **************************************

let width = 450;
let height = 450;

d3.select( "#map-container" )
    .append( "svg" )
    .attr("id", "map-svg")
    .attr( "width", width )
    .attr( "height", height );

let mapCanvas = d3.select("#map-svg");

const projection = d3.geoMercator()
                    .scale(3500)
                    .center([-85,44])
                    .translate([width/2, height/2 + 40]);

const path = d3.geoPath(projection);

const g = mapCanvas.append('g');

let michiganMap = "https://raw.githubusercontent.com/Dmujt/covid_dash/master/MI-26-michigan-counties.json";
let unemployment = "https://raw.githubusercontent.com/Dmujt/covid_dash/master/unemployment.csv"

var mapData = d3.map();

/*var mapSet = d3.csv("unemployment.csv",function(d) {
    mapData.set(d.county, +d.rate);
});*/

var selectedCounty = "Wayne";

var colorScale = d3.scaleThreshold()
    .domain([0, 2, 4, 6, 8, 10])
    .range(d3.schemeBlues[7]);

d3.json(michiganMap)
    .then(data => {

    d3.csv(unemployment).then(
        (data) => {
            data.forEach(function(d) {
                d.county = d.county;
                d.month = +d.month;
                d.rate = +d.rate;
            });

                unemployment = data.filter(function(d) { return d.month === 7 })
                })

            //console.log(typeof(unemployment))

    //     mapData.set(d.county, +d.rate)

    const geojsonmap = topojson.feature(data, data.objects.cb_2015_michigan_county_20m);

        //console.log(mapData);

        geojsonmap.features.forEach(function(d) {
            d.NAME = d.county;
        });


    g.selectAll('path')
        .data(geojsonmap.features)
        .enter()
        .append('path')
        .attr('class', 'county')
        .attr('d', path)
        .on("mouseover", function (d) {
            document.getElementById('number-container').innerHTML = d.properties.NAME;
        })
        .on("mouseout", function (d) {
            document.getElementById('number-container').innerHTML = "...";
        })
        .on("click", function (d) {
            selectedCounty = d.properties.NAME
            updateBarChart(selectedCounty);
            demoBarUpdate(selectedCounty);
        })
        .attr('fill',
            function (d) { return colorScale(8);});


    })

    window.onresize = resize;

});

</script>
</html>
